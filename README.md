# Dental CT-STL Registration Pipeline

A **stability-first, clinical-grade** registration system for aligning intraoral STL scans to CT coordinate systems for dental implant and surgical planning. Optimized for complex cases including heavy metal artifacts and varying scan resolutions.

---

## 1. ç³»çµ±æ¦‚è¿° (System Overview)

### ğŸ¯ Purpose
æœ¬ç³»çµ±å°ˆç‚º **ç‰™ç§‘æ¤ç‰™/æ‰‹è¡“è¦åŠƒ** è¨­è¨ˆï¼Œè§£æ±ºå¾å£å…§æƒæå„€ (IOS) ç²å–çš„ STL æ¨¡å‹èˆ‡ CT å½±åƒåæ¨™å°é½Šçš„å•é¡Œã€‚é€éè‡ªå‹•åŒ–çš„ DICOM è™•ç†ã€æ™ºæ…§å‹é–¾å€¼è¨ˆç®—ã€ä»¥åŠå¤šéšæ®µé…æº–æ¼”ç®—æ³•ï¼Œå¯¦ç¾é«˜ç²¾åº¦çš„ç©ºé–“å®šä½ã€‚

### ğŸ¥ Clinical Applications
| æ‡‰ç”¨å ´æ™¯ | èªªæ˜ |
|----------|------|
| **æ¤ç‰™å°å¼•æ¿è£½ä½œ** | å°‡ STL ç‰™å† æ¨¡å‹ç²¾ç¢ºå°é½Šè‡³ CT éª¨éª¼çµæ§‹ |
| **æ­£é¡æ‰‹è¡“è¦åŠƒ** | èåˆè¡“å‰ CT èˆ‡ç‰™åˆ—æ•¸ä½æ¨¡å‹ |
| **é½’é¡çŸ¯æ­£åˆ†æ** | çµåˆé½’æ§½éª¨èˆ‡ç‰™å† è³‡è¨Šé€²è¡Œ 3D è¨ºæ–· |
| **é‡‘å±¬å‡ç‰™æ‚£è€…è™•ç†** | å°ˆç”¨é‡‘å±¬å½å½±æŠ‘åˆ¶æ©Ÿåˆ¶ |

### âœ¨ Key Innovations
- **ç‰©ç†æ„ŸçŸ¥è™•ç† (Physics-Aware Processing)**: æ‰€æœ‰å½¢æ…‹å­¸é‹ç®—èˆ‡é›œè¨Šéæ¿¾å‡ä»¥ mm/mmÂ³ ç‚ºå–®ä½ï¼Œè€Œéåƒç´ ï¼Œç¢ºä¿è·¨è§£æåº¦ä¸€è‡´æ€§ã€‚
- **è‡ªé©æ‡‰é‡‘å±¬å½å½±è£œå„Ÿ (Metal Artifact Compensation)**: ç•¶åµæ¸¬åˆ° P99 > 3000 HU æ™‚ï¼Œè‡ªå‹•æé«˜é–¾å€¼ +150 HU ä»¥éš”é›¢ç·»å¯†çµæ§‹ã€‚
- **ä¸‰éšæ®µ ICP ç²¾ä¿® (Three-Stage ICP)**: 5.0mm â†’ 1.5mm â†’ 0.8mm æ¼¸é€²å¼æ”¶æ–‚ï¼Œé”æˆäºæ¯«ç±³ç´šç²¾åº¦ã€‚

---

## 2. æ ¸å¿ƒè™•ç†æµç¨‹ (Pipeline Flow)

ç³»çµ±åŒ…å«ä¸‰å€‹ä¸»è¦å·¥å…·ï¼Œå¯ç¨ç«‹æˆ–ä¸²è¯ä½¿ç”¨ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DENTAL CT-STL PIPELINE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  DICOM Series   â”‚â”€â”€â”€â”€â–¶â”‚   viewer.py     â”‚â”€â”€â”€â”€â–¶â”‚   CT Surface    â”‚   â”‚
â”‚   â”‚  (Raw CT Data)  â”‚     â”‚ (Preview/Export)â”‚     â”‚   (.stl)        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                         â”‚            â”‚
â”‚                                  â–¼                         â–¼            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   STL Scan      â”‚â”€â”€â”€â”€â–¶â”‚    main.py      â”‚â”€â”€â”€â”€â–¶â”‚ Transformation  â”‚   â”‚
â”‚   â”‚ (Intraoral)     â”‚     â”‚ (Registration)  â”‚     â”‚   Matrix        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              dicom_batch_to_ctl.py (Batch Processing)           â”‚   â”‚
â”‚   â”‚  Recursive scan â†’ CT modality filter â†’ Auto threshold â†’ STL    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.1 Registration Pipeline (`main.py`)

```
[Input]                    [Processing]                       [Output]
   â”‚                            â”‚                                â”‚
   â–¼                            â–¼                                â–¼
DICOM + STL â”€â”€â–¶ Identity Check (Inlier Ratio > 0.85?) â”€â”€â–¶ Skip to ICP
                      â”‚ No
                      â–¼
              Landmark Picking (Interactive)
                      â”‚
                      â–¼
              SVD Initial Alignment (3+ points)
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Three-Stage ICP         â”‚
              â”‚   â”œâ”€ Stage 1: 5.0mm/200i  â”‚  (Expansion Adsorption)
              â”‚   â”œâ”€ Stage 2: 1.5mm/100i  â”‚  (Transitional Refinement)
              â”‚   â””â”€ Stage 3: 0.8mm/100i  â”‚  (Precision Locking)
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              Quality Report + Transform Matrix
```

### 2.2 CT Surface Extraction (`viewer.py` / `dicom_batch_to_ctl.py`)

```
[DICOM Input]
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Adaptive HU Threshold Calculation   â”‚
â”‚     â€¢ Otsu on bone range [300-2500]     â”‚
â”‚     â€¢ Spacing Correction                â”‚
â”‚     â€¢ Metal Artifact Detection (+150)   â”‚
â”‚     â€¢ User Offset (+200)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Binary Segmentation                 â”‚
â”‚     â€¢ Threshold: [calculated] ~ 3000 HU â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Morphological Cleanup               â”‚
â”‚     â€¢ Opening (0.5mm radius)            â”‚
â”‚     â€¢ Severs thin artifact connections  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Connected Component Filtering       â”‚
â”‚     â€¢ Remove fragments < 15 mmÂ³         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Anti-Alias Smoothing (Optional)     â”‚
â”‚     â€¢ RMS linked to voxel spacing       â”‚
â”‚     â€¢ Forced if spacing > 0.5mm         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Marching Cubes Surface Extraction   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. Mesh Post-Processing                â”‚
â”‚     â€¢ Remove duplicated vertices        â”‚
â”‚     â€¢ Remove degenerate triangles       â”‚
â”‚     â€¢ Cluster filter (< 100 triangles)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
[STL Output]
```

---

## 3. æ¨¡çµ„æ¶æ§‹è¨­è¨ˆ (Module Architecture)

### 3.1 æª”æ¡ˆçµæ§‹ (File Structure)

```
c:\Dental-CT-STL-Registration\
â”‚
â”œâ”€â”€ main.py                      # ä¸»é…æº–æµç¨‹å…¥å£
â”œâ”€â”€ viewer.py                    # äº’å‹•å¼ CT/STL æª¢è¦–å™¨
â”œâ”€â”€ dicom_batch_to_ctl.py        # æ‰¹é‡ DICOM â†’ STL è½‰æ›
â”œâ”€â”€ landmark_picker.py           # ç¨ç«‹é¸é»å·¥å…· (legacy)
â”‚
â”œâ”€â”€ src/                         # æ ¸å¿ƒæ¨¡çµ„
â”‚   â”œâ”€â”€ dicom_loader.py          # DICOM è¼‰å…¥èˆ‡è¡¨é¢æå–
â”‚   â”œâ”€â”€ stl_loader.py            # STL è¼‰å…¥èˆ‡é»é›²è™•ç†
â”‚   â”œâ”€â”€ registration.py          # SVD å°é½Š + ICP ç²¾ä¿®
â”‚   â”œâ”€â”€ visualizer.py            # è¦–è¦ºåŒ–è¼”åŠ©å‡½å¼
â”‚   â””â”€â”€ utils.py                 # å“è³ªè©•ä¼°èˆ‡ I/O å·¥å…·
â”‚
â”œâ”€â”€ data/                        # åŸå§‹è³‡æ–™
â”‚   â””â”€â”€ CASE/cases/[case_name]/
â”‚       â”œâ”€â”€ DICOM/               # CT åˆ‡ç‰‡
â”‚       â””â”€â”€ mandible/            # å£æƒ STL
â”‚
â”œâ”€â”€ landmarks/                   # é¸é»çµæœ (JSON)
â”œâ”€â”€ processed/                   # é…æº–è¼¸å‡º (çŸ©é™£ + PLY)
â””â”€â”€ CT_CTL/                      # æ‰¹æ¬¡è½‰æ› STL è¼¸å‡º
```

### 3.2 æ¨¡çµ„è·è²¬ (Module Responsibilities)

| æ¨¡çµ„ | è·è²¬ | æ ¸å¿ƒå‡½å¼ |
|------|------|----------|
| **`main.py`** | é…æº–ä¸»æµç¨‹æ§åˆ¶ | `InteractiveLandmarkPicker`, `main()` |
| **`viewer.py`** | äº’å‹•æª¢è¦– + å–®ä¸€è½‰æ› | `calculate_adaptive_threshold()`, `extract_surface_from_ct()` |
| **`dicom_batch_to_ctl.py`** | æ‰¹é‡è½‰æ› + éŒ¯èª¤è™•ç† | `find_dicom_series()`, `batch_convert()` |
| **`src/dicom_loader.py`** | DICOM I/O | `load_dicom_series()`, `extract_teeth_surface()` |
| **`src/stl_loader.py`** | STL I/O + é»é›²é è™•ç† | `load_stl()`, `prepare_pointcloud_for_icp()` |
| **`src/registration.py`** | é…æº–æ¼”ç®—æ³• | `compute_rigid_transform_svd()`, `refine_with_icp()` |
| **`src/utils.py`** | å“è³ªæŒ‡æ¨™è¨ˆç®— | `compute_rmse()`, `compute_inlier_ratio()` |

### 3.3 è³‡æ–™æµ (Data Flow)

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚           USER INTERFACE             â”‚
                        â”‚  (CLI: main.py / viewer.py / batch)  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                            â”‚                            â”‚
              â–¼                            â–¼                            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  dicom_loader   â”‚         â”‚   stl_loader    â”‚         â”‚  registration   â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚  DICOM â†’ Mesh   â”‚         â”‚  STL â†’ PointCld â”‚         â”‚  SVD + ICP      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                           â”‚                           â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚       utils         â”‚
                              â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
                              â”‚  RMSE, I/O, Report  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 é—œéµæ¼”ç®—æ³• (Key Algorithms)

#### Adaptive HU Threshold
```python
threshold = Otsu(bone_range[300:2500])
threshold += spacing_correction(-200 * (voxel_eff - 0.3))
threshold += metal_offset(+150 if P99 > 3000)
threshold += user_offset(+200)
threshold = clip(threshold, 500, 3000)
```

#### Three-Stage ICP
| Stage | Max Distance | Iterations | Purpose |
|-------|--------------|------------|---------|
| 1 | 5.0 mm | 200 | æ“´å¼µå¸é™„ - æ•æ‰é è·å°æ‡‰é» |
| 2 | 1.5 mm | 100 | éæ¸¡å¾®èª¿ - ç©©å®šå°é½Šå§¿æ…‹ |
| 3 | 0.8 mm | 100 | ç²¾å¯†é–å®š - æœ€çµ‚é«˜ç²¾åº¦æ”¶æ–‚ |

---

## ğŸ’» Quick Start

### Installation
```bash
cd c:\Dental-CT-STL-Registration
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
```

### Basic Usage
```bash
# 1. å–®ä¸€æ¡ˆä¾‹äº’å‹•æª¢è¦–
python viewer.py --dicom-dir "data/CASE/cases/2023041801/DICOM" --hu-threshold auto

# 2. æ‰¹é‡è½‰æ›
python dicom_batch_to_ctl.py --input-dir "data/CT_problem" --output-dir "CT_CTL" --hu-threshold auto

# 3. å®Œæ•´é…æº–æµç¨‹
python main.py --case 2023041801 --landmarks landmarks/2023041801.json --interactive --visualize
```

---

## ğŸ“ Changelog

### v1.2.0 (Current)
- âœ… **Metal Artifact Reduction**: Changed threshold offset from -80 to +150, switched to Opening morphology.
- âœ… **Mesh Post-Processing**: Added cluster filtering to remove small disconnected fragments.
- âœ… **Batch Converter**: New `dicom_batch_to_ctl.py` with recursive scanning and memory management.
- âœ… **Threshold Limit Fix**: Upper clip increased to 3000 HU for proper artifact handling.
- âœ… **Empty Mesh Safety Check**: Prevents saving invalid STL files.

### v1.1.0
- âœ… Added `viewer.py` with physics-aware processing (mmÂ³ filters, mm-morphology).
- âœ… New Adaptive HU Thresholding (Percentile + Otsu + Metal Detection).
- âœ… Three-Stage ICP (5.0mm â†’ 1.5mm â†’ 0.8mm).
- âœ… Identity Transform Check for automated "Skip Picking" workflow.

### v1.0.0
- âœ… Initial SVD/ICP Registration Pipeline.
- âœ… Interactive Landmark Picking tool.
